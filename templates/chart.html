{% extends 'layout.html' %}
{%block head%}
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<title>Runtime Chart - MWBE</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
{% endblock %}

{% block content %}
<div class="mb-4">
    <h2><i class="bi bi-pie-chart"></i> Runtime Dağılımı</h2>
    <p class="text-muted">Uygulama runtime türlerinin dağılımını görüntüleyin</p>
</div>
    
    <div class="chart-container">
        <canvas id="runtime_chart"></canvas>
    </div>

    <div class="row mt-4">
        {%for runtime in runtime_stats%}
        {% if runtime[0]|capitalize in ['Liberty','Tomcat','Wasnd','Standalone']%}
        <div class="col-md-6 col-lg-3">
            <div class="card text-center h-100">
                <div class="card-body d-flex flex-column align-items-center justify-content-center p-4">
                    <img src="/static/{{runtime[0]|lower}}.png" class="mb-3" style="width: 80px; height: auto; filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));">
                    <h5 class="card-title mb-2">{{runtime[0]|capitalize}}</h5>
                    <p class="card-text">
                        <span class="badge bg-primary" style="font-size: 1.1rem; padding: var(--spacing-sm) var(--spacing-lg);">
                            {{runtime[1]}}
                        </span>
                    </p>
                </div>
            </div>
        </div>
        {%endif%}
        {%endfor%}
    </div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('runtime_chart');

  function extractString(input) {
    var match = input.match(/&#39;([^&#39;]+)&#39;/);
    if (match && match[1]) {
      return match[1];
    } else {
      return null;
    }
  }


  var runtimes = []
  '{%for runtime in runtime_stats%}'
  runtimes.push("{{runtime}}")
  '{%endfor%}'
  console.log(runtimes.map(row => row = row.split(',')[0]))
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: runtimes.map(row => row = extractString(row.split(',')[0])),
      datasets: [{
        data: runtimes.map(row => parseInt(row.split(',')[1].slice(0, -1)))
      }]
    },
    options: {
      plugins: {
        title: {
          text: "Runtime Dağılımı",
          display: true,
          font: {
            size: 20
          }
        },
      },
      responsive: true,
      maintainAspectRatio: false
    }
  });
</script>

{% endblock %}